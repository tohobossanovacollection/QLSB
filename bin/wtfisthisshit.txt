/**
 * HỆ THỐNG QUẢN LÝ SÂN BÓNG ĐÁ
 * Mô hình thiết kế MVC (Model-View-Controller)
 */

// ===== PHẦN MODEL =====
// Package: com.footballmanager.model

// Đối tượng Sân bóng
package com.footballmanager.model;

import java.util.ArrayList;
import java.util.List;

public class Pitch {
    private int id;
    private String name;
    private String type; // 5 người, 7 người, 11 người
    private double pricePerHour;
    private String description;
    private int branchId; // ID chi nhánh
    private boolean active;

    public Pitch(int id, String name, String type, double pricePerHour, String description, int branchId) {
        this.id = id;
        this.name = name;
        this.type = type;
        this.pricePerHour = pricePerHour;
        this.description = description;
        this.branchId = branchId;
        this.active = true;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public double getPricePerHour() {
        return pricePerHour;
    }

    public void setPricePerHour(double pricePerHour) {
        this.pricePerHour = pricePerHour;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public int getBranchId() {
        return branchId;
    }

    public void setBranchId(int branchId) {
        this.branchId = branchId;
    }

    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    @Override
    public String toString() {
        return "Sân [" + id + "] " + name + " - " + type;
    }
}

// Đối tượng Đặt sân
package com.footballmanager.model;

import java.time.LocalDateTime;

public class Booking {
    private int id;
    private int pitchId;
    private int customerId;
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    private double totalPrice;
    private String status; // PENDING, CONFIRMED, CANCELLED, COMPLETED
    private boolean isPeriodic; // Đặt định kỳ
    private String periodicType; // WEEKLY, MONTHLY
    private String note;
    private LocalDateTime createdAt;

    public Booking(int id, int pitchId, int customerId, LocalDateTime startTime, LocalDateTime endTime, 
                  double totalPrice, String status, boolean isPeriodic, String periodicType, String note) {
        this.id = id;
        this.pitchId = pitchId;
        this.customerId = customerId;
        this.startTime = startTime;
        this.endTime = endTime;
        this.totalPrice = totalPrice;
        this.status = status;
        this.isPeriodic = isPeriodic;
        this.periodicType = periodicType;
        this.note = note;
        this.createdAt = LocalDateTime.now();
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public int getPitchId() {
        return pitchId;
    }

    public void setPitchId(int pitchId) {
        this.pitchId = pitchId;
    }

    public int getCustomerId() {
        return customerId;
    }

    public void setCustomerId(int customerId) {
        this.customerId = customerId;
    }

    public LocalDateTime getStartTime() {
        return startTime;
    }

    public void setStartTime(LocalDateTime startTime) {
        this.startTime = startTime;
    }

    public LocalDateTime getEndTime() {
        return endTime;
    }

    public void setEndTime(LocalDateTime endTime) {
        this.endTime = endTime;
    }

    public double getTotalPrice() {
        return totalPrice;
    }

    public void setTotalPrice(double totalPrice) {
        this.totalPrice = totalPrice;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public boolean isPeriodic() {
        return isPeriodic;
    }

    public void setPeriodic(boolean periodic) {
        isPeriodic = periodic;
    }

    public String getPeriodicType() {
        return periodicType;
    }

    public void setPeriodicType(String periodicType) {
        this.periodicType = periodicType;
    }

    public String getNote() {
        return note;
    }

    public void setNote(String note) {
        this.note = note;
    }

    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    // Phương thức kiểm tra xung đột thời gian
    public boolean isConflictWith(Booking other) {
        return (this.startTime.isBefore(other.endTime) && this.endTime.isAfter(other.startTime));
    }
}

// Đối tượng Đơn tháng
package com.footballmanager.model;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.ArrayList;
import java.util.List;

public class MonthlyBooking {
    private int id;
    private int customerId;
    private int pitchId;
    private LocalDate startDate;
    private LocalDate endDate;
    private LocalTime startTime;
    private LocalTime endTime;
    private List<String> daysOfWeek; // e.g., "MONDAY", "WEDNESDAY", "FRIDAY"
    private int sessionsPerMonth;
    private double pricePerSession;
    private double totalAmount;
    private double discount;
    private double finalAmount;
    private String status; // ACTIVE, INACTIVE, COMPLETED
    private String note;

    public MonthlyBooking(int id, int customerId, int pitchId, LocalDate startDate, LocalDate endDate,
                         LocalTime startTime, LocalTime endTime, List<String> daysOfWeek,
                         int sessionsPerMonth, double pricePerSession, double discount, String note) {
        this.id = id;
        this.customerId = customerId;
        this.pitchId = pitchId;
        this.startDate = startDate;
        this.endDate = endDate;
        this.startTime = startTime;
        this.endTime = endTime;
        this.daysOfWeek = daysOfWeek;
        this.sessionsPerMonth = sessionsPerMonth;
        this.pricePerSession = pricePerSession;
        this.totalAmount = sessionsPerMonth * pricePerSession;
        this.discount = discount;
        this.finalAmount = totalAmount - discount;
        this.status = "ACTIVE";
        this.note = note;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public int getCustomerId() {
        return customerId;
    }

    public void setCustomerId(int customerId) {
        this.customerId = customerId;
    }

    public int getPitchId() {
        return pitchId;
    }

    public void setPitchId(int pitchId) {
        this.pitchId = pitchId;
    }

    public LocalDate getStartDate() {
        return startDate;
    }

    public void setStartDate(LocalDate startDate) {
        this.startDate = startDate;
    }

    public LocalDate getEndDate() {
        return endDate;
    }

    public void setEndDate(LocalDate endDate) {
        this.endDate = endDate;
    }

    public LocalTime getStartTime() {
        return startTime;
    }

    public void setStartTime(LocalTime startTime) {
        this.startTime = startTime;
    }

    public LocalTime getEndTime() {
        return endTime;
    }

    public void setEndTime(LocalTime endTime) {
        this.endTime = endTime;
    }

    public List<String> getDaysOfWeek() {
        return daysOfWeek;
    }

    public void setDaysOfWeek(List<String> daysOfWeek) {
        this.daysOfWeek = daysOfWeek;
    }

    public int getSessionsPerMonth() {
        return sessionsPerMonth;
    }

    public void setSessionsPerMonth(int sessionsPerMonth) {
        this.sessionsPerMonth = sessionsPerMonth;
        this.totalAmount = sessionsPerMonth * pricePerSession;
        this.finalAmount = totalAmount - discount;
    }

    public double getPricePerSession() {
        return pricePerSession;
    }

    public void setPricePerSession(double pricePerSession) {
        this.pricePerSession = pricePerSession;
        this.totalAmount = sessionsPerMonth * pricePerSession;
        this.finalAmount = totalAmount - discount;
    }

    public double getTotalAmount() {
        return totalAmount;
    }

    public double getDiscount() {
        return discount;
    }

    public void setDiscount(double discount) {
        this.discount = discount;
        this.finalAmount = totalAmount - discount;
    }

    public double getFinalAmount() {
        return finalAmount;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public String getNote() {
        return note;
    }

    public void setNote(String note) {
        this.note = note;
    }

    // Phương thức tạo các lịch đặt sân từ đơn tháng
    public List<Booking> generateBookings() {
        List<Booking> bookings = new ArrayList<>();
        // Logic để tạo các booking cụ thể từ đơn tháng
        // (triển khai theo logic của từng ngày trong tuần, startDate, endDate)
        return bookings;
    }
}

// Đối tượng Khách hàng
package com.footballmanager.model;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

public class Customer {
    private int id;
    private String name;
    private String phone;
    private String email;
    private String address;
    private String customerType; // REGULAR, VIP, TEAM
    private double totalSpent;
    private double debt;
    private LocalDateTime createdAt;
    private List<Booking> bookingHistory;
    private List<Invoice> invoiceHistory;

    public Customer(int id, String name, String phone, String email, String address, String customerType) {
        this.id = id;
        this.name = name;
        this.phone = phone;
        this.email = email;
        this.address = address;
        this.customerType = customerType;
        this.totalSpent = 0;
        this.debt = 0;
        this.createdAt = LocalDateTime.now();
        this.bookingHistory = new ArrayList<>();
        this.invoiceHistory = new ArrayList<>();
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    public String getCustomerType() {
        return customerType;
    }

    public void setCustomerType(String customerType) {
        this.customerType = customerType;
    }

    public double getTotalSpent() {
        return totalSpent;
    }

    public void addToTotalSpent(double amount) {
        this.totalSpent += amount;
    }

    public double getDebt() {
        return debt;
    }

    public void addToDebt(double amount) {
        this.debt += amount;
    }

    public void payDebt(double amount) {
        this.debt -= amount;
        if (this.debt < 0) {
            this.debt = 0;
        }
    }

    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public List<Booking> getBookingHistory() {
        return bookingHistory;
    }

    public void addBooking(Booking booking) {
        this.bookingHistory.add(booking);
    }

    public List<Invoice> getInvoiceHistory() {
        return invoiceHistory;
    }

    public void addInvoice(Invoice invoice) {
        this.invoiceHistory.add(invoice);
    }

    @Override
    public String toString() {
        return name + " (" + phone + ")";
    }
}

// Đối tượng Sản phẩm
package com.footballmanager.model;

public class Product {
    private int id;
    private String name;
    private String category;
    private double buyPrice;
    private double sellPrice;
    private int currentStock;
    private int minStockLevel;
    private String unit; // cái, chai, lon, ...
    private String description;
    private boolean active;

    public Product(int id, String name, String category, double buyPrice, double sellPrice, 
                 int currentStock, int minStockLevel, String unit, String description) {
        this.id = id;
        this.name = name;
        this.category = category;
        this.buyPrice = buyPrice;
        this.sellPrice = sellPrice;
        this.currentStock = currentStock;
        this.minStockLevel = minStockLevel;
        this.unit = unit;
        this.description = description;
        this.active = true;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getCategory() {
        return category;
    }

    public void setCategory(String category) {
        this.category = category;
    }

    public double getBuyPrice() {
        return buyPrice;
    }

    public void setBuyPrice(double buyPrice) {
        this.buyPrice = buyPrice;
    }

    public double getSellPrice() {
        return sellPrice;
    }

    public void setSellPrice(double sellPrice) {
        this.sellPrice = sellPrice;
    }

    public int getCurrentStock() {
        return currentStock;
    }

    public void updateStock(int quantity) {
        this.currentStock += quantity;
    }

    public int getMinStockLevel() {
        return minStockLevel;
    }

    public void setMinStockLevel(int minStockLevel) {
        this.minStockLevel = minStockLevel;
    }

    public String getUnit() {
        return unit;
    }

    public void setUnit(String unit) {
        this.unit = unit;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    public boolean isLowStock() {
        return currentStock <= minStockLevel;
    }

    @Override
    public String toString() {
        return name + " (" + currentStock + " " + unit + ")";
    }
}

// Đối tượng Hóa đơn
package com.footballmanager.model;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

public class Invoice {
    private int id;
    private int customerId;
    private LocalDateTime createdAt;
    private String type; // BOOKING, PRODUCT, MIXED
    private List<InvoiceItem> items;
    private double subtotal;
    private double discount;
    private double total;
    private double paid;
    private double debt;
    private String status; // PAID, PARTIAL, UNPAID
    private String note;

    public Invoice(int id, int customerId, String type, double discount, String note) {
        this.id = id;
        this.customerId = customerId;
        this.createdAt = LocalDateTime.now();
        this.type = type;
        this.items = new ArrayList<>();
        this.subtotal = 0;
        this.discount = discount;
        this.total = 0;
        this.paid = 0;
        this.debt = 0;
        this.status = "UNPAID";
        this.note = note;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public int getCustomerId() {
        return customerId;
    }

    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public String getType() {
        return type;
    }

    public List<InvoiceItem> getItems() {
        return items;
    }

    public void addItem(InvoiceItem item) {
        items.add(item);
        calculateSubtotal();
    }

    public void removeItem(InvoiceItem item) {
        items.remove(item);
        calculateSubtotal();
    }

    private void calculateSubtotal() {
        subtotal = 0;
        for (InvoiceItem item : items) {
            subtotal += item.getTotal();
        }
        calculateTotal();
    }

    public double getSubtotal() {
        return subtotal;
    }

    public double getDiscount() {
        return discount;
    }

    public void setDiscount(double discount) {
        this.discount = discount;
        calculateTotal();
    }

    private void calculateTotal() {
        total = subtotal - discount;
        this.debt = total - paid;
        updateStatus();
    }

    public double getTotal() {
        return total;
    }

    public double getPaid() {
        return paid;
    }

    public void addPayment(double amount) {
        this.paid += amount;
        this.debt = total - paid;
        updateStatus();
    }

    public double getDebt() {
        return debt;
    }

    private void updateStatus() {
        if (debt <= 0) {
            status = "PAID";
        } else if (paid > 0) {
            status = "PARTIAL";
        } else {
            status = "UNPAID";
        }
    }

    public String getStatus() {
        return status;
    }

    public String getNote() {
        return note;
    }

    public void setNote(String note) {
        this.note = note;
    }
}

// Đối tượng Chi tiết hóa đơn
package com.footballmanager.model;

public class InvoiceItem {
    private int id;
    private int invoiceId;
    private String itemType; // BOOKING, PRODUCT
    private int itemId; // ID của booking hoặc product
    private String description;
    private double unitPrice;
    private int quantity;
    private double total;

    public InvoiceItem(int id, int invoiceId, String itemType, int itemId, String description, 
                     double unitPrice, int quantity) {
        this.id = id;
        this.invoiceId = invoiceId;
        this.itemType = itemType;
        this.itemId = itemId;
        this.description = description;
        this.unitPrice = unitPrice;
        this.quantity = quantity;
        this.total = unitPrice * quantity;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public int getInvoiceId() {
        return invoiceId;
    }

    public String getItemType() {
        return itemType;
    }

    public int getItemId() {
        return itemId;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public double getUnitPrice() {
        return unitPrice;
    }

    public void setUnitPrice(double unitPrice) {
        this.unitPrice = unitPrice;
        this.total = unitPrice * quantity;
    }

    public int getQuantity() {
        return quantity;
    }

    public void setQuantity(int quantity) {
        this.quantity = quantity;
        this.total = unitPrice * quantity;
    }

    public double getTotal() {
        return total;
    }
}

// Đối tượng Giao dịch tài chính
package com.footballmanager.model;

import java.time.LocalDateTime;

public class Transaction {
    private int id;
    private String type; // INCOME, EXPENSE
    private String category; // BOOKING, PRODUCT_SALE, SALARY, MAINTENANCE, ...
    private double amount;
    private LocalDateTime date;
    private String description;
    private int relatedId; // ID của invoice hoặc expense
    private int branchId;

    public Transaction(int id, String type, String category, double amount, String description, 
                      int relatedId, int branchId) {
        this.id = id;
        this.type = type;
        this.category = category;
        this.amount = amount;
        this.date = LocalDateTime.now();
        this.description = description;
        this.relatedId = relatedId;
        this.branchId = branchId;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public String getType() {
        return type;
    }

    public String getCategory() {
        return category;
    }

    public void setCategory(String category) {
        this.category = category;
    }

    public double getAmount() {
        return amount;
    }

    public void setAmount(double amount) {
        this.amount = amount;
    }

    public LocalDateTime getDate() {
        return date;
    }

    public void setDate(LocalDateTime date) {
        this.date = date;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public int getRelatedId() {
        return relatedId;
    }

    public void setRelatedId(int relatedId) {
        this.relatedId = relatedId;
    }

    public int getBranchId() {
        return branchId;
    }

    public void setBranchId(int branchId) {
        this.branchId = branchId;
    }
}

// Đối tượng Chi nhánh
package com.footballmanager.model;

import java.util.ArrayList;
import java.util.List;

public class Branch {
    private int id;
    private String name;
    private String address;
    private String phone;
    private String managerName;
    private List<Pitch> pitches;
    private boolean active;

    public Branch(int id, String name, String address, String phone, String managerName) {
        this.id = id;
        this.name = name;
        this.address = address;
        this.phone = phone;
        this.managerName = managerName;
        this.pitches = new ArrayList<>();
        this.active = true;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getManagerName() {
        return managerName;
    }

    public void setManagerName(String managerName) {
        this.managerName = managerName;
    }

    public List<Pitch> getPitches() {
        return pitches;
    }

    public void addPitch(Pitch pitch) {
        pitches.add(pitch);
    }

    public void removePitch(Pitch pitch) {
        pitches.remove(pitch);
    }

    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    @Override
    public String toString() {
        return name + " (" + address + ")";
    }
}

// Đối tượng Người dùng hệ thống
package com.footballmanager.model;

import java.time.LocalDateTime;

public class User {
    private int id;
    private String username;
    private String password;
    private String fullName;
    private String email;
    private String phone;
    private String role; // ADMIN, MANAGER, STAFF
    private int branchId; // ID chi nhánh người dùng được phân công
    private boolean active;
    private LocalDateTime lastLogin;

    public User(int id, String username, String password, String fullName, String email, 
              String phone, String role, int branchId) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.fullName = fullName;
        this.email = email;
        this.phone = phone;
        this.role = role;
        this.branchId = branchId;
        this.active = true;
    }

    // Getters và Setters
    public int getId() {
        return id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getFullName() {
        return fullName;
    }

    public void setFullName(String fullName) {
        this.fullName = fullName;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getRole() {
        return role;
    }

    public void setRole(String role) {
        this.role = role;
    }

    public int getBranchId() {
        return branchId;
    }

    public void setBranchId(int branchId) {
        this.branchId = branchId;
    }

    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    public LocalDateTime getLastLogin() {
        return lastLogin;
    }

    public void setLastLogin(LocalDateTime lastLogin) {
        this.lastLogin = lastLogin;
    }
}

// ===== PHẦN DAO (Data Access Object) =====
// Package: com.footballmanager.dao

// Interface cho DAO chung
package com.footballmanager.dao;

import java.util.List;

public interface GenericDAO<T> {
    T findById(int id);
    List<T> findAll();
    boolean save(T entity);
    boolean update(T entity);
    boolean delete(int id);
}

// DAO cho Sân bóng
package com.footballmanager.dao;

import com.footballmanager.model.Pitch;
import java.util.List;

public interface PitchDAO extends GenericDAO<Pitch> {
    List<Pitch> findByBranch(int branchId);
    List<Pitch> findByType(String type);
}

// DAO cho Đặt sân
package com.footballmanager.dao;

import com.footballmanager.model.Booking;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;

public interface BookingDAO extends GenericDAO<Booking> {
    List<Booking> findByPitch(int pitchId);
    List<Booking> findByCustomer(int customerId);
    List<Booking> findByDate(LocalDate date);
    List<Booking> findByDateRange(LocalDate startDate, LocalDate endDate);
    List<Booking> findByPitchAndDateRange(int pitchId, LocalDateTime start, LocalDateTime end);
    boolean checkConflict(Booking booking);
}

// DAO cho Đơn tháng
package com.footballmanager.dao;

import com.footballmanager.model.MonthlyBooking;
import java.time.LocalDate;
import java.util.List;

public interface MonthlyBookingDAO extends GenericDAO<MonthlyBooking> {
    List<MonthlyBooking> findByCustomer(int customerId);
    List<MonthlyBooking> findByPitch(int pitchId);
    List<MonthlyBooking> findByStatus(String status);
    List<MonthlyBooking> findByMonth(int month, int year);
}

// DAO cho Khách hàng
package com.footballmanager.dao;

import com.footballmanager.model.Customer;
import java.util.List;

public interface CustomerDAO extends GenericDAO<Customer> {
    Customer findByPhone(String phone);
    List<Customer> findByType(String type);
    List<Customer> findByDebt();
    List<Customer> searchByName(String keyword);
}

// DAO cho Sản phẩm
package com.footballmanager.dao;

import com.footballmanager.model.Product;
import java.util.List;

public interface ProductDAO extends GenericDAO<Product> {
    List<Product> findByCategory(String category);
    List<Product> findLowStock();
    List<Product> searchByName(String keyword);
}

// DAO cho Hóa đơn
package com.footballmanager.dao;

import com.footballmanager.model.Invoice;
import java.time.LocalDate;
import java.util.List;

public interface InvoiceDAO extends GenericDAO<Invoice> {
    List<Invoice> findByCustomer(int customerId);
    List<Invoice> findByDate(LocalDate date);
    List<Invoice> findByDateRange(